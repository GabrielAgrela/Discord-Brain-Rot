<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lulucas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>O LUCAS TEM PERNINHAS DE FRANGO</h1>

    <div class="tables-container">
        <div class="table-container">
            <h2>Recent Actions</h2>
            <table id="actionsTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Username</th>
                        <th>Action</th>
                        <th>Target</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="actionsTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageActions">Previous</button>
                <span id="currentPageActions">1</span>
                <button id="nextPageActions">Next</button>
            </div>
        </div>

        <div class="table-container">
            <h2>Favorite Sounds</h2>
            <table id="favoritesTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Original Filename</th>
                    </tr>
                </thead>
                <tbody id="favoritesTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageFavorites">Previous</button>
                <span id="currentPageFavorites">1</span>
                <button id="nextPageFavorites">Next</button>
            </div>
        </div>

        <div class="table-container">
            <h2>All Sounds</h2>
            <table id="allSoundsTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Original Filename</th>
                    </tr>
                </thead>
                <tbody id="allSoundsTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageAllSounds">Previous</button>
                <span id="currentPageAllSounds">1</span>
                <button id="nextPageAllSounds">Next</button>
            </div>
        </div>
    </div>

    <script>
        const itemsPerPage = 10;
        let currentPageActions = 1;
        let currentPageFavorites = 1;
        let currentPageAllSounds = 1;

        function fetchData(endpoint, page, tableBodyId, currentPageId) {
            fetch(`/api/${endpoint}?page=${page}&per_page=${itemsPerPage}`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById(tableBodyId);
                    tableBody.innerHTML = '';
                    data.forEach(item => {
                        let row = '<tr>';
                        for (let key in item) {
                            row += `<td>${item[key]}</td>`;
                        }
                        row += '</tr>';
                        tableBody.innerHTML += row;
                    });
                    document.getElementById(currentPageId).textContent = page;
                });
        }

        function setupPagination(prevButtonId, nextButtonId, currentPageVar, fetchFunction) {
            document.getElementById(prevButtonId).addEventListener('click', () => {
                if (window[currentPageVar] > 1) {
                    window[currentPageVar]--;
                    fetchFunction(window[currentPageVar]);
                }
            });

            document.getElementById(nextButtonId).addEventListener('click', () => {
                window[currentPageVar]++;
                fetchFunction(window[currentPageVar]);
            });
        }

        function fetchActions(page) {
            fetchData('actions', page, 'actionsTableBody', 'currentPageActions');
        }

        function fetchFavorites(page) {
            fetchData('favorites', page, 'favoritesTableBody', 'currentPageFavorites');
        }

        function fetchAllSounds(page) {
            fetchData('all_sounds', page, 'allSoundsTableBody', 'currentPageAllSounds');
        }

        setupPagination('prevPageActions', 'nextPageActions', 'currentPageActions', fetchActions);
        setupPagination('prevPageFavorites', 'nextPageFavorites', 'currentPageFavorites', fetchFavorites);
        setupPagination('prevPageAllSounds', 'nextPageAllSounds', 'currentPageAllSounds', fetchAllSounds);

        // Initial data fetch
        fetchActions(currentPageActions);
        fetchFavorites(currentPageFavorites);
        fetchAllSounds(currentPageAllSounds);

        // Auto-refresh every 5 seconds (adjust as needed)
        setInterval(() => {
            fetchActions(currentPageActions);
            fetchFavorites(currentPageFavorites);
            fetchAllSounds(currentPageAllSounds);
        }, 5000);
    </script>
</body>
</html>