<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lulucas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <h1>O LUCAS TEM PERNINHAS DE FRANGO</h1>

    <div class="tables-container">
        <div class="table-container">
            <h2>Recent Actions</h2>
            <table id="actionsTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Username</th>
                        <th>Action</th>
                        <th>Target</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="actionsTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageActions">Previous</button>
                <span id="currentPageActions">1</span>
                <button id="nextPageActions">Next</button>
            </div>
        </div>

        <div class="table-container">
            <h2>Favorite Sounds</h2>
            <table id="favoritesTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Original Filename</th>
                    </tr>
                </thead>
                <tbody id="favoritesTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageFavorites">Previous</button>
                <span id="currentPageFavorites">1</span>
                <button id="nextPageFavorites">Next</button>
            </div>
        </div>

        <div class="table-container">
            <h2>All Sounds</h2>
            <table id="allSoundsTable">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Original Filename</th>
                    </tr>
                </thead>
                <tbody id="allSoundsTableBody">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPageAllSounds">Previous</button>
                <span id="currentPageAllSounds">1</span>
                <button id="nextPageAllSounds">Next</button>
            </div>
        </div>
    </div>

    <script>
        const itemsPerPage = 10;
        let currentPageActions = 1;
        let currentPageFavorites = 1;
        let currentPageAllSounds = 1;

        function fetchData(endpoint, page, tableBodyId, currentPageId) {
            console.log(`Fetching ${endpoint} data for page ${page}`);
            fetch(`/api/${endpoint}?page=${page}&per_page=${itemsPerPage}`)
                .then(response => response.json())
                .then(data => {
                    console.log(`Received ${data.length} items for ${endpoint}`);
                    const tableBody = document.getElementById(tableBodyId);
                    tableBody.innerHTML = '';
                    data.forEach(item => {
                        let row = '<tr>';
                        for (let key in item) {
                            row += `<td>${item[key]}</td>`;
                        }
                        row += '</tr>';
                        tableBody.innerHTML += row;
                    });
                    document.getElementById(currentPageId).textContent = page;
                })
                .catch(error => console.error('Error:', error));
        }

        function setupPagination(prevButtonId, nextButtonId, currentPageVar, fetchFunction) {
            const prevButton = document.getElementById(prevButtonId);
            const nextButton = document.getElementById(nextButtonId);

            prevButton.addEventListener('click', () => {
                console.log(`Previous button clicked for ${currentPageVar}`);
                if (window[currentPageVar] > 1) {
                    window[currentPageVar]--;
                    console.log(`${currentPageVar} is now ${window[currentPageVar]}`);
                    fetchFunction(window[currentPageVar]);
                }
            });

            nextButton.addEventListener('click', () => {
                console.log(`Next button clicked for ${currentPageVar}`);
                window[currentPageVar]++;
                console.log(`${currentPageVar} is now ${window[currentPageVar]}`);
                fetchFunction(window[currentPageVar]);
            });
        }

        function fetchActions(page) {
            console.log(`Fetching actions for page ${page}`);
            fetchData('actions', page, 'actionsTableBody', 'currentPageActions');
        }

        function fetchFavorites(page) {
            console.log(`Fetching favorites for page ${page}`);
            fetchData('favorites', page, 'favoritesTableBody', 'currentPageFavorites');
        }

        function fetchAllSounds(page) {
            console.log(`Fetching all sounds for page ${page}`);
            fetchData('all_sounds', page, 'allSoundsTableBody', 'currentPageAllSounds');
        }

        setupPagination('prevPageActions', 'nextPageActions', 'currentPageActions', fetchActions);
        setupPagination('prevPageFavorites', 'nextPageFavorites', 'currentPageFavorites', fetchFavorites);
        setupPagination('prevPageAllSounds', 'nextPageAllSounds', 'currentPageAllSounds', fetchAllSounds);

        // Initial data fetch
        fetchActions(currentPageActions);
        fetchFavorites(currentPageFavorites);
        fetchAllSounds(currentPageAllSounds);

        // Auto-refresh every 5 seconds (adjust as needed)
        setInterval(() => {
            fetchActions(currentPageActions);
            fetchFavorites(currentPageFavorites);
            fetchAllSounds(currentPageAllSounds);
        }, 5000);

        function adjustFontSize() {
            const cells = document.querySelectorAll('td');
            cells.forEach(cell => {
                const content = cell.textContent;
                const span = document.createElement('span');
                span.textContent = content;
                cell.textContent = '';
                cell.appendChild(span);

                let fontSize = 0.9;
                span.style.fontSize = `${fontSize}em`;

                while (span.scrollWidth > cell.clientWidth && fontSize > 0.5) {
                    fontSize -= 0.05;
                    span.style.fontSize = `${fontSize}em`;
                }
            });
        }

        // Call the function when the page loads
        window.addEventListener('load', adjustFontSize);
        // Also call it if the window is resized
        window.addEventListener('resize', adjustFontSize);
    </script>
</body>
</html>