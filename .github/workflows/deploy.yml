name: Deploy and Restart Service

on:
  push:
    branches: [ master ]  # Triggers when PR is merged to master
  pull_request:
    types: [ closed ]
    branches: [ master ]

jobs:
  deploy:
    # Only run when PR is merged (not just closed)
    if: github.event_name == 'push' || github.event.pull_request.merged == true
    runs-on: self-hosted  # This assumes you have a self-hosted runner on your server
    
    steps:
    - name: Pull latest code and restart service
      run: |
        cd /home/gabi/github/Discord-Brain-Rot
        git pull origin master
        sudo systemctl restart personalgreeter.service
        
    - name: Verify service is running
      run: |
        sleep 5
        sudo systemctl is-active --quiet personalgreeter.service && echo "Service is running" || exit 1 